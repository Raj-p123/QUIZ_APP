<div class="overview-clean">

  <ng-container *ngIf="quizData$ | async as quiz; else loadingOrError">

    <!-- ===== TOP BAR ===== -->
    <div class="top-row">
      <button class="back-btn" (click)="goBack()">‚Üê Back</button>

      <div class="title-block">
        <h1>{{ quiz.title }}</h1>
        <p>{{ quiz.description || 'Test your knowledge and track your progress' }}</p>
      </div>
    </div>

    <!-- ===== QUICK INFO STRIP ===== -->
    <div class="info-strip">
      <div class="info-item">
        <span>Questions</span>
        <strong>{{ quiz.totalQuestions }}</strong>
      </div>

      <div class="info-item">
        <span>Time / Q</span>
        <strong>{{ quiz.timePerQuestionSeconds }} sec</strong>
      </div>

      <div class="info-item">
        <span>Last Score</span>
        <strong>
          {{ quiz.lastScore !== null ? quiz.lastScore + '%' : '--' }}
        </strong>
      </div>

      <div class="info-item">
        <span>Attempts</span>
        <strong>{{ quiz.attempts }}</strong>
      </div>
    </div>

    <!-- ===== START SECTION ===== -->
    <div class="start-section" *ngIf="!quiz.error">

      <div>
        <h3 *ngIf="quiz.attempts === 0">
          Start your first attempt
        </h3>

        <h3 *ngIf="quiz.attempts > 0">
          Try again and improve your score
        </h3>

        <p>You can attempt this quiz multiple times.</p>
      </div>

      <button class="start-btn" (click)="startQuiz()">
        Start Quiz
      </button>

    </div>

    <!-- ===== ATTEMPT SUMMARY ===== -->
    <div class="attempt-summary" *ngIf="totalAttempts > 0">

      <div class="summary-box">
        <span>Total Attempts</span>
        <strong>{{ totalAttempts }}</strong>
      </div>

      <div class="summary-box">
        <span>Best Score</span>
        <strong>{{ bestScore }}%</strong>
      </div>

      <div class="summary-box">
        <span>Average Score</span>
        <strong>{{ averageScore }}%</strong>
      </div>

    </div>

    <!-- ===== NEW PROFESSIONAL ATTEMPT HISTORY ===== -->
    <div class="history-section" *ngIf="quiz.attemptHistory?.length">

      <h2 class="history-title">Attempt History</h2>

      <div class="attempt-card"
           *ngFor="let attempt of quiz.attemptHistory; let i = index">

        <!-- STATUS -->
        <div class="attempt-badge-status">
          Attempted
        </div>

        <!-- DATE -->
        <div class="attempt-date">
          {{ attempt.date }}
        </div>

        <!-- DETAILS -->
        <div class="attempt-details">

          <div class="detail-box">
            üìã
            <span>
              {{ attempt.score }}/{{ quiz.totalQuestions }}
            </span>
          </div>

          <div class="detail-box">
            ‚è±
            <span>
              {{ attempt.timeTaken || '00:05:00' }}
            </span>
          </div>

          <div class="detail-box">
            üéì
            <span>
              {{
                ((attempt.score / quiz.totalQuestions) * 100)
                | number:'1.2-2'
              }}%
            </span>
          </div>

          <button class="review-btn"
        (click)="goToReview(attempt.id)">
  Review
</button>

        </div>

      </div>

    </div>

  </ng-container>

  <ng-template #loadingOrError>
    <div class="loading-clean">
      Fetching quiz details...
    </div>
  </ng-template>

</div>